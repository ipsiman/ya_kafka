# Kafka Producer & Consumer –Ω–∞ Python

–≠—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–∞–±–æ—Ç—É —Å Apache Kafka –≤ —Ä–µ–∂–∏–º–µ KRaft (–±–µ–∑ ZooKeeper) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Python. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø—Ä–æ–¥—é—Å–µ—Ä –∏ –±–∞—Ç—á-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å, –∑–∞–ø—É—Å–∫–∞–µ–º—ã–µ –≤ Docker —Å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ–º (–ø–æ 2 —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–∞–∂–¥–æ–≥–æ).

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ docker-compose.yml          # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
‚îú‚îÄ‚îÄ Dockerfile                  # –°–±–æ—Ä–∫–∞ Python-–æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ requirements.txt            # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ message_model.py            # –ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ producer.py                 # –ü—Ä–æ–¥—é—Å–µ—Ä: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
‚îú‚îÄ‚îÄ batch_message_consumer.py   # –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å: —á–∏—Ç–∞–µ—Ç –±–∞—Ç—á–∞–º–∏
‚îú‚îÄ‚îÄ single_message_consumer.py  # –ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å: —á–∏—Ç–∞–µ—Ç –ø–æ –æ–¥–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
‚îú‚îÄ‚îÄ topic.txt                   # –ö–æ–º–∞–Ω–¥—ã –∫–æ–Ω—Å–æ–ª–∏ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–ø–∏–∫–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Ç–æ–ø–∏–∫–µ
‚îî‚îÄ‚îÄ README.md                   # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## –ö–ª–∞—Å—Å—ã –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. `MessageModel` (`message_model.py`)

–ú–æ–¥–µ–ª—å —Å–æ–æ–±—â–µ–Ω–∏—è, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º–æ–≥–æ —á–µ—Ä–µ–∑ Kafka.

```python
class MessageModel:
    def __init__(self, message_id, content):
        self.message_id = message_id
        self.content = content
```

- **`serialize()`** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –æ–±—ä–µ–∫—Ç –≤ JSON –∏ –∫–æ–¥–∏—Ä—É–µ—Ç –≤ `bytes` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Kafka.
- **`deserialize(data)`** ‚Äî –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –æ–±—ä–µ–∫—Ç –∏–∑ –±–∞–π—Ç–æ–≤–æ–≥–æ JSON-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è.

> –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É producer –∏ consumer.

---

### 2. `producer.py`

–ü—Ä–æ–¥—é—Å–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π:
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã.
- –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ `MessageModel`.
- –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —Ç–æ–ø–∏–∫ `final-1-topic`.
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `confluent_kafka` —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –¥–æ—Å—Ç–∞–≤–∫–∏.

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ retry –∏ idempotence.
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Kafka —á–µ—Ä–µ–∑ –≤–Ω–µ—à–Ω–∏–µ –ø–æ—Ä—Ç—ã (`9094`, `9095`, `9096`).

---

### 3. `batch_message_consumer.py`

–ë–∞—Ç—á-–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π:
- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è **–ø–∞—á–∫–∞–º–∏** (–¥–æ 10 –∑–∞ —Ä–∞–∑).
- –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∏—Ö –≤ `MessageModel`.
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ª–æ–≥–∏—Ä—É–µ—Ç.
- –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç offset **–ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ–≥–æ –±–∞—Ç—á–∞** (`at-least-once` —Å–µ–º–∞–Ω—Ç–∏–∫–∞).

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
- `enable.auto.commit: False` ‚Äî —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
- `max.poll.records: 10` ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞.
- –ì—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π: `batch-group`.

---

### 4. `single_message_consumer.py`

–ü–æ—Ç—Ä–µ–±–∏—Ç–µ–ª—å, –∫–æ—Ç–æ—Ä—ã–π:
- –ß–∏—Ç–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è **–ø–æ –æ–¥–Ω–æ–º—É**.
- –î–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç –∏—Ö –≤ `MessageModel`.
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏ –ª–æ–≥–∏—Ä—É–µ—Ç.

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏**:
- `enable.auto.commit: False` ‚Äî —Ä—É—á–Ω–æ–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ.
- –ì—Ä—É–ø–ø–∞ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π: `single-group`.

### 5. `docker-compose.yml`

–ó–∞–ø—É—Å–∫–∞–µ—Ç:
- **3-–Ω–æ–¥–æ–≤—ã–π Kafka-–∫–ª–∞—Å—Ç–µ—Ä** –≤ —Ä–µ–∂–∏–º–µ KRaft.
- **Kafka UI** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
- **Producer √ó2** —á–µ—Ä–µ–∑ `replicas`.

---

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É

### 1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:
- Docker
- Docker Compose

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–ª–∞—Å—Ç–µ—Ä –∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø—Ä–æ–¥—é—Å–µ—Ä)

```bash
docker compose up
```

### 3. –°–æ–∑–¥–∞–π—Ç–µ —Ç–æ–ø–∏–∫ `final-1-topic` 

```bash
docker exec -it unit_1_final-kafka-0-1 kafka-topics.sh --create \
  --topic final-1-topic \
  --bootstrap-server localhost:9092 \
  --partitions 3 \
  --replication-factor 2
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π

```bash
python batch_message_consumer.py
```
–∏–ª–∏ / –∏
```bash
python single_message_consumer.py
```

---

## –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

### 1. –õ–æ–≥–∏ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **–ø—Ä–æ–¥—é—Å–µ—Ä—ã** –ø–∏—à—É—Ç:
  ```
  producer-1  | Message delivered to project-topic [0]
  producer-2  | Message delivered to project-topic [0]
  ```

- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ **–ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏** —á–∏—Ç–∞—é—Ç:
  ```
  INFO:root:SingleConsumer received: Test message 2886
  ```

### 2. Kafka UI
–û—Ç–∫—Ä–æ–π –±—Ä–∞—É–∑–µ—Ä: [http://localhost:8080](http://localhost:8080)

#### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
- **–ö–ª–∞—Å—Ç–µ—Ä `kraft`** ‚Äî –∞–∫—Ç–∏–≤–µ–Ω.
- **–¢–æ–ø–∏–∫ `final-1-topic`**:
  - –†–∞—Å—Ç—ë—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π (–≤ —Å–µ–∫—Ü–∏–∏ `Messages`).
  - Offset —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.
